ุนุงู ๐
ุจุฐุงุฑ ุชุฑุฌูู ุฏูู ู ุญุฑููโุง ๐ ุงู ุจุฎุด ุงุฒ **ุถููู A: Concurrency II** ุฑู ุจุฑุงุช ุงูุฌุงู ุจุฏู.๐

---

## ๐ ุถููู A

# ๐งต ููโุฑููุฏ (Concurrency) โ ุจุฎุด ุฏูู

โ๏ธ ููุดุชู: **Brett L. Schuchert**

ุงู ุถููู ุจู ูุตู ยซููโุฑููุฏยป ุฏุฑ ุตูุญู 177 ฺฉุชุงุจ ๐งผ *Clean Code* ฺฉูฺฉ ูโฺฉูุฏ ู ุขู ุฑุง ฺฏุณุชุฑุด ูโุฏูุฏ. ุงู ุจุฎุด ุจูโุตูุฑุช ูุฌููุนูโุง ุงุฒ ููุถูุนุงุช ูุณุชูู ููุดุชู ุดุฏู ุงุณุช ู ูุนูููุงู ูโุชูุงู ุขูโูุง ุฑุง ุจู ูุฑ ุชุฑุชุจ ูุทุงูุนู ฺฉุฑุฏ. ุจุฑุง ุงูฺฉู ุงู ููุน ูุทุงูุนู ุงูฺฉุงูโูพุฐุฑ ุจุงุดุฏุ ุฏุฑ ุจุฎุดโูุง ูุฎุชูู ููุฏุงุฑ ุชฺฉุฑุงุฑ ุฏุฏู ูโุดูุฏ.

---

## ๐ป ูุซุงู Client/Server (ฺฉุงุฑุจุฑ / ุณุฑูุฑ)

ูุฑุถ ฺฉูุฏ ฺฉ ุจุฑูุงูู ุณุงุฏูโ **Client/Server** ุฏุงุฑู.
๐ธ ฺฉ **ุณุฑูุฑ (Server)** ุฑู ฺฉ *ุณูฺฉุช (Socket)* ููุชุธุฑ ูโูุงูุฏ ุชุง ฺฉ **ฺฉูุงูุช (Client)** ุจู ุขู ูุตู ุดูุฏ.
๐ธ ฺฉ **ฺฉูุงูุช** ูุตู ุดุฏู ู ฺฉ ุฏุฑุฎูุงุณุช ุงุฑุณุงู ูโฺฉูุฏ.

---

## ๐ฅ๏ธ ุณุฑูุฑ (The Server)

ุฏุฑ ุงุฏุงูู ูุณุฎูโ ุณุงุฏูโุดุฏูโุง ุงุฒ ฺฉ ุจุฑูุงููโ ุณุฑูุฑ ุฑุง ูโุจูุฏ.
๐ ูุณุฎู ฺฉุงูู ฺฉุฏ ุงู ูุซุงู ุฏุฑ ุตูุญู 343 ุจุง ุนููุงู **Client/Server Nonthreaded** ุขูุฏู ุงุณุช:

```java
ServerSocket serverSocket = new ServerSocket(8009);
while (keepProcessing) {
    try {
        Socket socket = serverSocket.accept();
        process(socket);
    } catch (Exception e) {
        handle(e);
    }
}
```

ุงู ุจุฑูุงูู ุณุงุฏู ููุชุธุฑ ฺฉ ุงุชุตุงู ูโูุงูุฏุ ูพุงู ูุฑูุฏ ุฑุง ูพุฑุฏุงุฒุด ูโฺฉูุฏ ู ุณูพุณ ุฏูุจุงุฑู ููุชุธุฑ ุฏุฑุฎูุงุณุช ุจุนุฏ ุงุฒ ฺฉูุงูุช ูโูุดูุฏ.
ุฏุฑ ุงุฏุงููุ ฺฉุฏ ูุฑุจูุท ุจู **ฺฉูุงูุช** ุฑุง ูโุจูุฏ ฺฉู ุจู ุงู ุณุฑูุฑ ูุตู ูโุดูุฏ:

```java
private void connectSendReceive(int i) {
    try {
        Socket socket = new Socket("localhost", PORT);
        MessageUtils.sendMessage(socket, Integer.toString(i));
        MessageUtils.getMessage(socket);
        socket.close();
    } catch (Exception e) {
        e.printStackTrace();
    }
}
```

---

## ๐ ุจุฑุฑุณ ุนููฺฉุฑุฏ (Performance)

ุนููฺฉุฑุฏ ุงู ุฌูุช Client/Server ฺุทูุฑ ุงุณุชุ
ฺุทูุฑ ูโุชูุงูู ุงู ุนููฺฉุฑุฏ ุฑุง ุจูโุตูุฑุช ุฑุณู ุชูุตู ฺฉููุ
ุฏุฑ ุงูุฌุง ฺฉ ุชุณุช ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ุจุฑุฑุณ ูโฺฉูุฏ ุขุง ุนููฺฉุฑุฏ ุณุณุชู ยซูุงุจู ูุจููยป ุงุณุช ุง ูู:

```java
@Test(timeout = 10000)
public void shouldRunInUnder10Seconds() throws Exception {
    Thread[] threads = createThreads();
    startAllThreadsw(threads);
    waitForAllThreadsToFinish(threads);
}
```

๐ ุชูุธูุงุช ุงููู ุงู ุชุณุช ุจุฑุง ุณุงุฏฺฏ ุญุฐู ุดุฏู ุงุณุช (ุจู ูุงู **ClientTest.java** ุฏุฑ ุตูุญู 344 ูุฑุงุฌุนู ฺฉูุฏ).
ุงู ุชุณุช ุงูุชุธุงุฑ ุฏุงุฑุฏ ฺฉู ุงุฌุฑุง ฺฉู ุนููุงุช ุฏุฑ ฺฉูุชุฑ ุงุฒ **ฑฐูฌฐฐฐ ููโุซุงูู** (ฑฐ ุซุงูู) ุงูุฌุงู ุดูุฏ โฑ๏ธ

---

## ๐ ุจุฑุฑุณ ุชูุงู ุนููุงุช (Throughput)

ุงู ฺฉ ูุซุงู ฺฉูุงุณฺฉ ุงุฒ ุงุนุชุจุงุฑุณูุฌ **Throughput** ุณุณุชู ุงุณุช.
ุฏุฑ ุงู ุณุณุชูุ ุจุงุฏ ูุฌููุนูโุง ุงุฒ ุฏุฑุฎูุงุณุชโูุง ฺฉูุงูุช ุฏุฑ ฑฐ ุซุงูู ุชฺฉูู ุดููุฏ.
ุชุง ุฒูุงู ฺฉู ุณุฑูุฑ ุจุชูุงูุฏ ูุฑ ุฏุฑุฎูุงุณุช ุฑุง ุจูโูููุน ูพุฑุฏุงุฒุด ฺฉูุฏุ ุชุณุช ุจุง ููููุช ูพุงุณ ูโุดูุฏ โ

ุงูุง ุงฺฏุฑ ุชุณุช ุดฺฉุณุช ุจุฎูุฑุฏ ฺูุ ๐ค
ุฏุฑ ุตูุฑุช ฺฉู ููุน **Event Polling Loop** (ุญููู ุจุฑุฑุณ ุฑูุฏุงุฏูุง) ุทุฑุงุญ ูฺฉููุ ุฏุฑ ฺฉ **ุชฺฉโุฑุดุชู (Single Thread)** ฺฉุงุฑ ุฎุงุต ููโุชูุงู ุจุฑุง ุณุฑุนโุชุฑ ฺฉุฑุฏู ุงู ฺฉุฏ ุงูุฌุงู ุฏุงุฏ.

ุขุง ุงุณุชูุงุฏู ุงุฒ ฺูุฏ ุฑุดุชู (Multiple Threads) ูโุชูุงูุฏ ูุดฺฉู ุฑุง ุญู ฺฉูุฏุ
ุดุงุฏุ ุงูุง ุงุจุชุฏุง ุจุงุฏ ุจุฏุงูู ุฒูุงู ุฏููุงู ฺฉุฌุง ุตุฑู ูโุดูุฏ. ุฏู ุญุงูุช ฺฉู ูุฌูุฏ ุฏุงุฑุฏ:

* ๐ **I/O** (ูุฑูุฏ/ุฎุฑูุฌ): ูุซู ุงุณุชูุงุฏู ุงุฒ ุณูฺฉุชุ ุงุชุตุงู ุจู ุฏุชุงุจุณุ ุงูุชุธุงุฑ ุจุฑุง Swap ุดุฏู ุญุงูุธู ูุฌุงุฒ ู ููุงุฑุฏ ูุดุงุจู.
* ๐งฎ **Processor** (ูพุฑุฏุงุฒูุฏู): ูุซู ุงูุฌุงู ูุญุงุณุจุงุช ุนุฏุฏุ ูพุฑุฏุงุฒุด Regular Expressionูุงุ Garbage Collection ู ููุงุฑุฏ ูุดุงุจู.

ุจูโุทูุฑ ูุนููู ุณุณุชูโูุง ููุฏุงุฑ ุงุฒ ูุฑ ุฏู ููุฑุฏ ุฑุง ุฏุงุฑูุฏุ ุงูุง ุฏุฑ ูุฑ ุนููุงุช ฺฉ ุงุฒ ุขูโูุง ุบุงูุจ ุงุณุช.

ุงฺฏุฑ ฺฉุฏ **Processor-bound** ุจุงุดุฏุ ุงูุฒูุฏู ุณุฎุชโุงูุฒุงุฑ ูพุฑุฏุงุฒุด ุจุดุชุฑ ูโุชูุงูุฏ Throughput ุฑุง ุงูุฒุงุด ุฏูุฏ ู ุจุงุนุซ ููููุช ุชุณุช ุดูุฏ.
ุงูุง ฺูู ฺุฑุฎูโูุง CPU ูุญุฏูุฏูุฏุ ุงูุฒูุฏู Thread ุจู ฺฉ ูุณุฆูู Processor-bound ุจุงุนุซ ุงูุฒุงุด ุณุฑุนุช ููโุดูุฏ โ๏ธ

ุงุฒ ุทุฑู ุฏฺฏุฑุ ุงฺฏุฑ ูุฑุขูุฏ **I/O-bound** ุจุงุดุฏุ ุงุณุชูุงุฏู ุงุฒ ููโุฑููุฏ (Concurrency) ูโุชูุงูุฏ ุจุงุฒุฏู ุฑุง ุงูุฒุงุด ุฏูุฏ โ
ุฏุฑ ุงู ุญุงูุชุ ุฒูุงู ฺฉู ฺฉ ุจุฎุด ุงุฒ ุณุณุชู ููุชุธุฑ I/O ุงุณุชุ ุจุฎุด ุฏฺฏุฑ ูโุชูุงูุฏ ุงุฒ ููุงู ุฒูุงู ุจุฑุง ูพุฑุฏุงุฒุด ฺฉุงุฑ ุฏฺฏุฑ ุงุณุชูุงุฏู ฺฉูุฏ ู ุงุฒ CPU ุจูุฑูโูุฑ ุจูุชุฑ ุจฺฏุฑุฏ ๐ก

---

## ๐งต ุงูุฒูุฏู ฺูุฏุฑุณูุงู (Adding Threading)

ูุฑุถ ฺฉูู ุชุณุช ุนููฺฉุฑุฏ ุดฺฉุณุช ุฎูุฑุฏู ุงุณุช.
ฺุทูุฑ ูโุชูุงูู **Throughput** ุฑุง ุจูุจูุฏ ุฏูู ุชุง ุชุณุช ุจุง ููููุช ูพุงุณ ุดูุฏุ

ุงฺฏุฑ ูุชุฏ `process` ุณุฑูุฑ **I/O-bound** ุจุงุดุฏุ ฺฉ ุฑูุด ุงู ุงุณุช ฺฉู ุณุฑูุฑ ุฑุง ุจู ุดฺฉู ฺูุฏุฑุณูุงู (Threaded) ุชุบุฑ ุฏูู.
ฺฉุงู ุงุณุช ููุท ูุญููโ ูพุฑุฏุงุฒุด ูพุงู ุฑุง ุนูุถ ฺฉูู:

```java
void process(final Socket socket) {
    if (socket == null)
        return;
    Runnable clientHandler = new Runnable() {
        public void run() {
            try {
                String message = MessageUtils.getMessage(socket);
                MessageUtils.sendMessage(socket, "Processed: " + message);
                closeIgnoringException(socket);
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    };
    Thread clientConnection = new Thread(clientHandler);
    clientConnection.start();
}
```

ูุฑุถ ฺฉูุฏ ุงู ุชุบุฑ ุจุงุนุซ ุดุฏู ุชุณุช ุนููฺฉุฑุฏ ูพุงุณ ุดูุฏ โ
ฺฉุฏ ฺฉุงูู ุดุฏู ุงุณุชุ ุฏุฑุณุช ุงุณุชุ ๐ค

(๐ ูพุงุณุฎ ุงู ุณุคุงู ุฏุฑ ุงุฏุงูู ูุตู ุจุฑุฑุณ ูโุดูุฏโฆ)

---

โ ุชุฑุฌูู ฺฉุงูู ู ุฏูู ุงู ุจุฎุด ุงูุฌุงู ุดุฏุ ุชูุงู ุงุตุทูุงุญุงุช ุชุฎุตุต ูุซู `Socket`, `Thread`, `I/O`, `Processor-bound` ุญูุธ ุดุฏูโุงูุฏ ู ูุชู ุจุฑุง ุฎูุงููุฏู ุจุฏูู ูพุดโุฒููู ุจุฑูุงููโููุณ ุฑูุงู ู ูุงุจู ููู ุจุงุฒููุณ ุดุฏู ุงุณุช.
ุงุฒ ุงููุฌโูุง ูู ุจู ุดฺฉู ุงุณุชุงูุฏุงุฑุฏ ู ูุฑุชุจุท ุงุณุชูุงุฏู ุดุฏู ๐โจ

ูโุฎูุง ููู ุฑููุฏ ุฑู ุจุฑุง ุจุฎุด ุจุนุฏ (ุตูุญู 320 ุจู ุจุนุฏ) ูู ุงุฏุงูู ุจุฏูุ ๐๐
